{% extends 'courses/base.html' %}

{% block title %}æˆç¸¾å–® - {{ user.get_full_name }}{% endblock %}

{% block content %}
<h1>ğŸ“‹ æˆç¸¾å–® - {{ user.get_full_name }}</h1>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">å­¸ç”Ÿè³‡è¨Š</h5>
                <p><strong>ä½¿ç”¨è€…åç¨±ï¼š</strong> {{ user.username }}</p>
                <p><strong>å§“åï¼š</strong> {{ user.get_full_name }}</p>
                <p><strong>ä¿¡ç®±ï¼š</strong> {{ user.email }}</p>
                {% if user.profile.phone %}
                    <p><strong>é›»è©±ï¼š</strong> {{ user.profile.phone }}</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">æˆç¸¾çµ±è¨ˆ</h5>
                <p><strong>ä¿®ç¿’èª²ç¨‹æ•¸ï¼š</strong> <span class="badge bg-primary">{{ enrollments.count }}</span></p>
                <p><strong>ç¸½å¹³å‡åˆ†æ•¸ï¼š</strong> 
                    {% if average_score %}
                        <span class="badge bg-success" style="font-size: 16px;">{{ average_score|floatformat:2 }}</span>
                    {% else %}
                        <span class="badge bg-warning">å¾…ç™»éŒ„</span>
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</div>

<h3>ä¿®ç¿’èª²ç¨‹</h3>

{% if enrollments %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>èª²è™Ÿ</th>
                <th>èª²å</th>
                <th>ä»»èª²è€å¸«</th>
                <th>å­¸åˆ†</th>
                <th>æœŸä¸­</th>
                <th>æœŸæœ«</th>
                <th>ç§‘ç›®åˆ†æ•¸</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for enrollment in enrollments %}
            <tr>
                <td>
                    <a href="{% url 'courses:course_detail' enrollment.course.id %}">
                        {{ enrollment.course.course_code }}
                    </a>
                </td>
                <td>
                    <a href="{% url 'courses:course_detail' enrollment.course.id %}">
                        {{ enrollment.course.course_name }}
                    </a>
                </td>
                <td>{{ enrollment.course.teacher.user.get_full_name }}</td>
                <td>{{ enrollment.course.credits }}</td>
                <td>
                    {% if enrollment.midterm_score %}
                        {{ enrollment.midterm_score }}
                    {% else %}
                        <span class="badge bg-secondary">æœªç™»éŒ„</span>
                    {% endif %}
                </td>
                <td>
                    {% if enrollment.final_score %}
                        {{ enrollment.final_score }}
                    {% else %}
                        <span class="badge bg-secondary">æœªç™»éŒ„</span>
                    {% endif %}
                </td>
                <td>
                    {% if enrollment.get_total_score %}
                        <strong class="text-success">{{ enrollment.get_total_score }}</strong>
                    {% else %}
                        <span class="badge bg-warning">å¾…ç™»éŒ„</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'courses:drop_course' enrollment.id %}" class="btn btn-sm btn-danger" onclick="return confirm('ç¢ºå®šé€€é¸æ­¤èª²ç¨‹å—ï¼Ÿ');">é€€é¸</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-warning" role="alert">
    <h4 class="alert-heading">å°šæœªé¸èª²</h4>
    <p>æ‚¨ç›®å‰é‚„æ²’æœ‰é¸ä¿®ä»»ä½•èª²ç¨‹ã€‚è«‹å‰å¾€<a href="{% url 'courses:course_list' %}">èª²ç¨‹åˆ—è¡¨</a>é¸èª²ã€‚</p>
</div>
{% endif %}

<h3 class="mt-5">å¯é¸èª²ç¨‹</h3>

{% with enrolled_course_ids=enrollments.values_list|join:"," %}
<div class="row">
    {% for course in enrollments %}
        {% comment %} This is just showing enrolled courses, we need a separate view for available courses {% endcomment %}
    {% endfor %}
</div>

<p>
    <a href="{% url 'courses:course_list' %}" class="btn btn-primary">
        ğŸ” ç€è¦½æ‰€æœ‰èª²ç¨‹ä¸¦é¸èª²
    </a>
</p>
{% endwith %}
{% endblock %}
